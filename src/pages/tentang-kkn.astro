---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import MemberCard from '../components/MemberCard.astro';
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import { getCollection } from 'astro:content';

// Fetch KKN page content from the pages collection
const allPages = await getCollection('pages');
const kknPageContent = allPages.find(page => page.slug.includes('tentang-kkn'));
const data = kknPageContent ? kknPageContent.data : {
  judul: "Tentang KKN Reguler Periode 117",
  deskripsi: "Tentang tim pengembang website dari KKN UIN Sunan Kalijaga",
  informasiKKN: {
    judulInfo: "Tim Pengembang Website",
    isiInfo: "Website ini merupakan bagian dari program KKN...",
    gambarUrl: "default-image.jpg",
    timKKN: []
  }
};

const allImages = await import.meta.glob<{ default: ImageMetadata }>('/src/assets/images/**/*.{jpeg,jpg,png,gif,webp,svg}');
const introImagePath = Object.keys(allImages).find(path => path.endsWith(data.informasiKKN.gambarUrl || 'kkn-team.webp'));

// Fetch and sort the KKN members by the 'order' field
const kknMembers = (await getCollection('kkn')).sort((a, b) => a.data.order - b.data.order);
---
<Layout 
    title="Tentang KKN | Website Dusun Bedalo"
    description="Mengenal tim KKN Reguler Angkatan 117 dari UIN Sunan Kalijaga Yogyakarta."
>
    <Header currentPage="Tentang KKN" />
    <main>
        <section class="bg-orange-500 text-white py-12">
            <div class="container mx-auto px-6 text-center">
                <h1 class="text-4xl font-bold" data-aos="fade-down">{data.judul}</h1>
                <p class="mt-2 text-lg" data-aos="fade-up" data-aos-delay="100">{data.deskripsi}</p>
            </div>
        </section>
        <section class="py-20 bg-white">
            <div class="container mx-auto px-6 max-w-5xl">
                <div class="grid md:grid-cols-2 gap-12 items-center">
                    <div data-aos="fade-right">
                        {introImagePath ?
(
                            <Image 
                                src={allImages[introImagePath]()} 
                                alt="Tim KKN UIN Sunan Kalijaga"
                                width="800"
                                height="600"
                                class="rounded-xl shadow-lg w-full h-full object-cover"
                            />
                        ) : <div class="rounded-xl shadow-lg w-full aspect-video bg-gray-200"></div>}
                    </div>
                    <div data-aos="fade-left" data-aos-delay="100">
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">{data.informasiKKN.judulInfo}</h2>
                        <p class="text-gray-600 leading-relaxed">{data.informasiKKN.isiInfo}</p>
                    </div>
                </div>
           </div>
        </section>
        <section class="py-20">
            <div class="container mx-auto px-6">
                <div class="text-center max-w-3xl mx-auto">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4" data-aos="fade-up">Anggota Kelompok 129 - Bedalo</h2>
                    <p class="text-gray-600 mb-12" data-aos="fade-up" data-aos-delay="100">
                        Kami adalah tim mahasiswa yang berdedikasi untuk memberikan kontribusi positif kepada masyarakat Dusun Bedalo.
                    </p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-5xl mx-auto">
                    {kknMembers.map((member, index) => (
                         <div data-aos="fade-up" data-aos-delay={100 + (index * 50)}>
                            <MemberCard member={member.data} allImages={allImages} />
                        </div>
                    ))}
                </div>
             </div>
        </section>
    </main>
    <Footer />
</Layout>