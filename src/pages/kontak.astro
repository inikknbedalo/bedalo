---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import PageBanner from '../components/PageBanner.astro';
import SectionTitle from '../components/SectionTitle.astro';
import ContactForm from '../components/ContactForm.astro';
import ContactPersonCard from '../components/ContactPersonCard.astro'; // <-- Import new component
import { getCollection } from 'astro:content';
import type { ImageMetadata } from 'astro';

// Fetch contact page content from the pages collection
const allPages = await getCollection('pages');
const contactPageContent = allPages.find(page => page.slug.includes('kontak'));
const data = contactPageContent ? contactPageContent.data : {
  judul: "Kontak",
  deskripsi: "Hubungi perangkat dusun atau kirimkan aspirasi Anda",
  informasiKontak: {
    alamat: "",
    email: "",
    telepon: "",
    mapsUrl: "",
    formAspirasi: {
      judul: "",
      deskripsi: "",
      formActionUrl: "",
      entry: {}
    },
    kontakPemerintah: []
  }
};

// Use the correctly typed glob import for dynamic images
const allImages = await import.meta.glob<{ default: ImageMetadata }>('/src/assets/images/**/*.{jpeg,jpg,png,gif,webp,svg}');
---
<Layout 
    title="Kontak & Aspirasi | Website Dusun Bedalo"
    description="Hubungi perangkat Dusun Bedalo atau sampaikan ide dan aspirasi Anda melalui formulir kontak kami."
>
    <Header currentPage="Kontak" />

    <main>
        <PageBanner 
            title="Hubungi Kami"
            subtitle="Informasi Kontak dan Saluran Aspirasi Warga"
            bgColor="bg-blue-600"
        />

        <section id="kontak-perangkat" class="py-20 overflow-hidden">
            <div class="container mx-auto px-6">
                <SectionTitle title="Kontak Perangkat Dusun" />
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
                    {data.informasiKontak.kontakPemerintah.map((item, index) => (
                        <div data-aos="fade-up" data-aos-delay={100 + index * 100}>
                            {/* Use the new component */}
                            <ContactPersonCard item={item} allImages={allImages} />
                        </div>
                    ))}
                </div>
            </div>
        </section>

        <section id="aspirasi" class="py-20 bg-white overflow-hidden">
            <div class="container mx-auto px-6">
                {/* The ContactForm component can remain as is, but now it's paired with a SectionTitle */}
                <div class="max-w-4xl mx-auto" data-aos="fade-up" data-aos-delay="200">
                    <ContactForm formData={data.informasiKontak.formAspirasi} />
                </div>
            </div>
        </section>
    </main>

    <Footer />
</Layout>